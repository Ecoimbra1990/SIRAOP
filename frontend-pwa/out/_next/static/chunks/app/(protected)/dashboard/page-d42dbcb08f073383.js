(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4],{6142:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},4807:function(e,t,a){Promise.resolve().then(a.bind(a,6143))},6143:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return DashboardPage}});var s=a(7437),r=a(2265),n=a(4033),i=a(9843),c=a(7179),l=a(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,l.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),d=(0,l.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),x=(0,l.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),u=(0,l.Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),m=(0,l.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var h=a(6142);function DashboardPage(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[p,y]=(0,r.useState)([]),[g,f]=(0,r.useState)(!0),[v,j]=(0,r.useState)(""),[N,b]=(0,r.useState)(""),[w,k]=(0,r.useState)(!1),{user:L}=(0,c.L)(),C=(0,n.useRouter)();(0,r.useEffect)(()=>{loadOcorrencias()},[]),(0,r.useEffect)(()=>{filterOcorrencias()},[e,v,N]);let loadOcorrencias=async()=>{try{let e=await i.vh.getAll();t(e)}catch(e){console.error("Erro ao carregar ocorr\xeancias:",e)}finally{f(!1)}},filterOcorrencias=()=>{let t=e;v&&(t=t.filter(e=>{var t;return e.tipo.toLowerCase().includes(v.toLowerCase())||e.endereco.toLowerCase().includes(v.toLowerCase())||(null===(t=e.bairro)||void 0===t?void 0:t.toLowerCase().includes(v.toLowerCase()))})),N&&(t=t.filter(e=>e.status===N)),l(t)},handleSelectOcorrencia=e=>{y(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleGerarInformativo=async()=>{if(0===p.length){alert("Selecione pelo menos uma ocorr\xeancia para gerar o relat\xf3rio");return}try{k(!0),await i.BV.gerarInformativoPDF(p),y([])}catch(e){console.error("Erro ao gerar PDF:",e),alert("Erro ao gerar relat\xf3rio PDF")}finally{k(!1)}},formatDate=e=>new Date(e).toLocaleDateString("pt-BR");return g?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Bem-vindo, ",null==L?void 0:L.nome_completo]})]}),(0,s.jsxs)("button",{onClick:()=>C.push("/ocorrencias/nova"),className:"btn-primary flex items-center gap-2",children:[(0,s.jsx)(o,{className:"h-4 w-4"}),"Nova Ocorr\xeancia"]})]})}),(0,s.jsx)("div",{className:"card mb-6",children:(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Tipo, endere\xe7o, bairro...",value:v,onChange:e=>j(e.target.value),className:"input pl-10"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,s.jsxs)("select",{value:N,onChange:e=>b(e.target.value),className:"input",children:[(0,s.jsx)("option",{value:"",children:"Todos os status"}),(0,s.jsx)("option",{value:"ativa",children:"Ativa"}),(0,s.jsx)("option",{value:"arquivada",children:"Arquivada"}),(0,s.jsx)("option",{value:"resolvida",children:"Resolvida"})]})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)("button",{onClick:handleGerarInformativo,disabled:0===p.length||w,className:"btn-secondary flex items-center gap-2 w-full",children:[(0,s.jsx)(x,{className:"h-4 w-4"}),w?"Gerando...":"Gerar PDF (".concat(p.length,")")]})})]})})}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"card-title",children:"Ocorr\xeancias"}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[a.length," ocorr\xeancia(s) encontrada(s)"]})]})}),(0,s.jsx)("div",{className:"card-content p-0",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left",children:(0,s.jsx)("input",{type:"checkbox",checked:p.length===a.length&&a.length>0,onChange:()=>{p.length===a.length?y([]):y(a.map(e=>e.id))},className:"rounded border-gray-300"})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"Data/Hora"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"Tipo"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"Endere\xe7o"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"OPM"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"Lan\xe7ado em"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:a.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>C.push("/ocorrencias/".concat(e.id)),children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("input",{type:"checkbox",checked:p.includes(e.id),onChange:t=>{t.stopPropagation(),handleSelectOcorrencia(e.id)},className:"rounded border-gray-300"})}),(0,s.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-900",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(u,{className:"h-4 w-4 text-gray-400"}),formatDate(e.data_hora_fato)]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-gray-500",children:[(0,s.jsx)(m,{className:"h-3 w-3"}),new Date(e.data_hora_fato).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:e.tipo})}),(0,s.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-900",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 text-gray-400"}),e.endereco]}),e.bairro&&(0,s.jsx)("div",{className:"text-gray-500 text-xs",children:e.bairro})]}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.opm||"-"}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("ativa"===e.status?"bg-red-100 text-red-800":"resolvida"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:formatDate(e.created_at)})]},e.id))})]})})})]})]})}},9843:function(e,t,a){"use strict";a.d(t,{BV:function(){return l},iJ:function(){return i},vh:function(){return c}});var s=a(4829),r=a(7179);let n=s.Z.create({baseURL:"https://siraop-backend.fly.dev/api",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{let t=r.L.getState().token;return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(r.L.getState().logout(),window.location.href="/login"),Promise.reject(e)});let i={login:async(e,t)=>{let a=await n.post("/auth/login",{email:e,password:t});return a.data},register:async e=>{let t=await n.post("/auth/register",e);return t.data}},c={getAll:async()=>{let e=await n.get("/ocorrencias");return e.data},getById:async e=>{let t=await n.get("/ocorrencias/".concat(e));return t.data},create:async e=>{let t=await n.post("/ocorrencias",e);return t.data},update:async(e,t)=>{let a=await n.patch("/ocorrencias/".concat(e),t);return a.data},delete:async e=>{let t=await n.delete("/ocorrencias/".concat(e));return t.data},findNearby:async(e,t,a)=>{let s=await n.get("/ocorrencias/nearby",{params:{lat:e,lng:t,radius:a}});return s.data}},l={gerarInformativoPDF:async e=>{let t=await n.post("/relatorios/informativo-pdf",{ocorrenciaIds:e},{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");return s.href=a,s.setAttribute("download","informativo_".concat(Date.now(),".pdf")),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a),t.data}}},7179:function(e,t,a){"use strict";a.d(t,{L:function(){return n}});var s=a(4660),r=a(4810);let n=(0,s.Ue)()((0,r.tJ)(e=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,login:(t,a)=>{e({user:t,token:a,isAuthenticated:!0,isLoading:!1})},logout:()=>{e({user:null,token:null,isAuthenticated:!1,isLoading:!1})},setLoading:t=>{e({isLoading:t})}}),{name:"siraop-auth-storage",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[811,829,971,472,744],function(){return e(e.s=4807)}),_N_E=e.O()}]);